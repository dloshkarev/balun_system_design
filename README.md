# Проектирование социальной сети для путешественников

---

## Функциональные требования

- создание поста (текстовое описание, гео метка и фотографии)
- добавление реакции на посты
- добавление комментариев к постам (только текст)
- просмотр комментариев к постам
- подписка на других пользователей
- поиск постов по гео метке
- просмотр своей ленты, основанной на подписках в обратном хронологическом порядке
- просмотр ленты других пользователей

---

## Нефункциональные требования

- DAU - 10000000
- География - СНГ
- Предположим, что каждый пользователь:
    - Cоздает новый пост 1 раз в неделю, каждый пост собирает 15 комментариев
    - Пишет 10 комментариев в день
    - Читает комментарии к 20 постам в день
    - Подписывается на 1 пользователя в день
    - Просматривает 100 постов 1 раз в неделю через поиск по гео метке, просматривая также все комментарии к ним
    - Просматривает в своей ленте 100 постов в день
    - Просматривает в ленте других пользователей 50 постов в день в сумме
    - Подписан на 150 человек
    - Имеет 100 подписчиков
    - Ставит лайки 50 постам в день
- Сезонность - летом и в периоды праздников активность удваивается
- Хранение данных - вечно
- Максимальное количество фотографий, которое можно приложить к посту = 10
- Максимальный размер оригинального фото - 5 мб, после конвертации в формат для ленты размер уменьшается в 2 раза
- Максимальный размер текста - 500 символов (без поддержки эмодзи)
- Максимальное время загрузки ленты пользователя - 3 сек
- Максимальное время поиска постов по гео метке - 5 сек

### Примерная структура сущностей

**Пост:**

| Поле      | Размер    |
|:----------|:----------|
| user_id   | 8 байт    |
| текст     | 1000 байт |
| latitude  | 8 байт    |
| longitude | 8 байт    |
| фото      | 10 * 5 мб = 50 мб (25 мб для ленты) |
| **Итого**     | 50 мб |

**Комментарий:**

| Поле           | Размер    |
|:---------------|:----------|
| user_id  | 8 байт    |
| post_id | 8 байт    |
| текст | 1000 байт |
| **Итого**     | 1 Кб      |

**Реакция:**

| Поле           | Размер |
|:---------------|:-------|
| user_id  | 8 байт |
| post_id | 8 байт |
| type_id | 8 байт |
| **Итого**     | 24 байта |

---

## Расчет нагрузки требования

Посты:
- RPS (write) - 10000000 / (7 * 86400) = 2 * 17 = 34
- RPS (read) - (100 * 10000000 + 50 * 10000000) / 86400 + 100 * 10000000 / (7 * 864000) = 2 * 17527 = 35054
- Traffic (write) - 34 * 50мб = 1,7 Гб/с
- Traffic (read) - 35054 * 2.5мб = 88 Гб/с (читаем только текст и 1 фото, т.к остальные подгружаются позже из карусели)

Комментарии:
- RPS (write) - 10 * 10000000 / 86400 = 2 * 1157 = 2315
- RPS (read) - (15 * 20 * 10000000) / 86400 = 2 * 34722 = 69444
- Traffic (write) - 2315 * 1Кб = 2,3 Мб/с
- Traffic (read) - 69444 * 1Кб = 69,4 Мб/с

Реакции:
- RPS (write) - 50 * 10000000 / 86400 = 2 * 5787 = 11574
- RPS (read) - 35054
- Traffic (write) - 11574 * 24Кб = 278 Кб/с
- Traffic (read) - 35054 * 24Кб = 841 Кб/с